# PetWealth Parents ‚Äî DEV Documentation

–ú–µ—Ç–∞: –ø–æ–≤–Ω–∞ —Ç–µ—Ö–Ω—ñ—á–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏, —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –±–æ—Ç–∞.

---

## 1) –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ –ø–æ—Ç–æ–∫–∏

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:
- app/ ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥—É (main.py), —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–æ—Ç–∞, –∫–æ–Ω—Ñ—ñ–≥—ñ–≤ —ñ —Ä–æ—É—Ç–µ—Ä—ñ–≤.
- bot/ ‚Äî —É—Å—ñ aiogram-—Ö–µ–Ω–¥–ª–µ—Ä–∏, –º–∞—Ä—à—Ä—É—Ç–∏, —Å–ª—É–∂–±–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ —Å–∞–ø–ø–æ—Ä—Ç—É.
- core/ ‚Äî –∫–æ–Ω—Ñ—ñ–≥, –ë–î, —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó (Enote), —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó, –±—ñ–∑–Ω–µ—Å-—Å–µ—Ä–≤—ñ—Å–∏.
- infra/ ‚Äî —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ñ —Ä–µ—á—ñ (–ª–æ–≥-—Ö–µ–Ω–¥–ª–µ—Ä–∏ —Ç–æ—â–æ).
- logs/ ‚Äî —Ñ–∞–π–ª–æ–≤—ñ –ª–æ–≥–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, enote_link.log).

–ü–æ—Ç—ñ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (—Å–ø—Ä–æ—â–µ–Ω–æ):
1. –ö–ª—ñ—î–Ω—Ç ‚Üí –ø–∏—à–µ –±–æ—Ç—É ‚Üí bot/routers/client.py —Å—Ç–≤–æ—Ä—é—î/–æ–Ω–æ–≤–ª—é—î —Ç—ñ–∫–µ—Ç.
2. –ë–æ—Ç ‚Üí —Ä–µ–ª–µ—ó—Ç—å —É —Å–∞–ø–ø–æ—Ä—Ç-–≥—Ä—É–ø—É –≤ —Ç–µ–º—É –∫–ª—ñ—î–Ω—Ç–∞.
3. Staff –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î ‚Üí –±–æ—Ç –ø–µ—Ä–µ—Å–∏–ª–∞—î –∫–ª—ñ—î–Ω—Ç—É.
4. –ê–¥–º—ñ–Ω—Å—å–∫—ñ –∫–æ–º–∞–Ω–¥–∏ –∫–µ—Ä—É—é—Ç—å —Å—Ç–∞—Ç—É—Å–∞–º–∏, –µ—Ç–∏–∫–µ—Ç–∫–∞–º–∏, –ø—Ä–∏–≤‚Äô—è–∑–∫–∞–º–∏ –¥–æ Enote.

---

## 2) –§–∞–π–ª–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- app/main.py ‚Äî —Å—Ç–∞—Ä—Ç –±–æ—Ç–∞, –∫–æ–º–∞–Ω–¥–∏, –º–∞—Ä—à—Ä—É—Ç–∏.
- bot/routers/staff.py ‚Äî /client, /phone, /assign, /label, /auto_label, /patient.
- bot/routers/enote_link.py ‚Äî /enote_link, FSM, callback-–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è.
- core/integrations/enote.py ‚Äî —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Enote (OData + API).
- core/repositories/clients.py ‚Äî –æ–ø–µ—Ä–∞—Ü—ñ—ó –Ω–∞–¥ pp_clients.
- core/db.py ‚Äî MySQL connector.
- core/config.py ‚Äî –∑—á–∏—Ç—É—î .env.
- logs/enote_link.log ‚Äî –ø–æ–¥—ñ—ó /enote_link.

---

## 3) .env –º—ñ–Ω—ñ–º—É–º

BOT_TOKEN=...  
BOT_USERNAME=PetWealthParentsBot  
SUPPORT_GROUP_ID=-1002992147362  

DB_HOST=127.0.0.1  
DB_PORT=3306  
DB_USER=olexii_raid  
DB_PASSWORD=Z4vBrpT7@9uLMxWg  
DB_NAME=petwealth  

ENOTE_ODATA_URL=https://app.enote.vet/<uuid>/odata/standard.odata  
ENOTE_ODATA_USER=odata  
ENOTE_ODATA_PASS=********  
ENOTE_API_URL=https://app.enote.vet/<uuid>/hs/api/v2  
ENOTE_API_KEY=********************************  

---

## 4) –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö

### pp_clients
- telegram_id (PK)
- phone, phone_confirmed
- label, total_closed
- owner_ref_key, owner_name_enote, owner_phone_enote
- linked_contract_number, linked_by, linked_at

### tickets
- thread_id, client_user_id, status, label, assigned_to

---

## 5) –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Enote

- OData ‚Üí –ø–æ—à—É–∫ –∫–∞—Ä—Ç–∫–∏ –∑–∞ –Ω–æ–º–µ—Ä–æ–º –¥–æ–≥–æ–≤–æ—Ä—É.
- API hs/api/v2/GetClient ‚Üí –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ü–Ü–ë —ñ —Ç–µ–ª–µ—Ñ–æ–Ω—É.
- owner_ref_key –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø–æ–¥–∞–ª—å—à–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤.

---

## 6) –ö–æ–º–∞–Ω–¥–∏ —Ç–∞ —Ä–æ—É—Ç–µ—Ä–∏

### /enote_link  
–ü—Ä–∏–≤‚Äô—è–∑—É—î –∫–ª—ñ—î–Ω—Ç–∞ –¥–æ –≤–ª–∞—Å–Ω–∏–∫–∞ –≤ –Ñ–Ω–æ—Ç—ñ.  
–ó–∞–ø–∏—Å—É—î –¥–∞–Ω—ñ –≤ `pp_clients` (owner_ref_key, owner_name_enote, owner_phone_enote, linked_by, linked_at).

### /phone (–∞–±–æ /client)
–ü–æ–∫–∞–∑—É—î –∫–∞—Ä—Ç–∫—É –∫–ª—ñ—î–Ω—Ç–∞:
- —è–∫—â–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∏ –∑–±—ñ–≥–∞—é—Ç—å—Å—è ‚Äî –æ–¥–∏–Ω —Ä—è–¥–æ–∫ ‚Äú(–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ ‚úÖ)‚Äù;
- —è–∫—â–æ —Ä—ñ–∑–Ω—ñ ‚Äî ‚Äú–±–æ—Ç‚Äù —ñ ‚Äú–Ñ–Ω–æ—Ç [enote]‚Äù.

### /patient  
–ü–æ–∫–∞–∑—É—î —Å–ø–∏—Å–æ–∫ —É—Å—ñ—Ö —Ç–≤–∞—Ä–∏–Ω –≤–ª–∞—Å–Ω–∏–∫–∞:  
> –ö–ª–∏—á–∫–∞ ‚Äî –ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä—É

### /auto_label  
–§–æ—Ä–º—É—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É –Ω–∞–∑–≤—É —Ç–µ–º–∏:
> –Ü–º‚Äô—è–í–ª–∞—Å–Ω–∏–∫–∞ ‚Äî –¢–≤–∞—Ä–∏–Ω–∞1(–¥–æ–≥–æ–≤—ñ—Ä), –¢–≤–∞—Ä–∏–Ω–∞2(–¥–æ–≥–æ–≤—ñ—Ä)  
+ –æ–Ω–æ–≤–ª—é—î `label` —É —Ç–∞–±–ª–∏—Ü—ñ `pp_clients`.

---

## 7) –õ–æ–≥–∏
- logs/enote_link.log ‚Äî —É—Å—ñ –ø–æ–¥—ñ—ó /enote_link (preview, linked, cancel, error).

---

## 8) –î–µ–ø–ª–æ–π
systemd unit:
[Unit]
Description=PetWealth Parents Dev Bot
After=network-online.target

[Service]
WorkingDirectory=/root/Python/PWParents-dev/PWParents
Environment="PYTHONPATH=/root/Python/PWParents-dev/PWParents"
ExecStart=/root/Python/PWParents-dev/venv/bin/python app/main.py
Restart=always
RestartSec=5
User=root

[Install]
WantedBy=multi-user.target

---

## 9) –¢–µ—Å—Ç-—á–µ–∫–ª—ñ—Å—Ç
‚úÖ /enote_link ‚Äî –ø—Ä–µ–≤‚Äô—é, –∑–∞–ø–∏—Å —É –ë–î, –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è  
‚úÖ /phone ‚Äî –ø–æ–∫–∞–∑—É—î –æ–±–∏–¥–≤–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∏ –∞–±–æ –æ–¥–∏–Ω  
‚úÖ /patient ‚Äî –≤–∏–≤–æ–¥–∏—Ç—å —É—Å—ñ—Ö —Ç–≤–∞—Ä–∏–Ω  
‚úÖ /auto_label ‚Äî –ø–µ—Ä–µ–π–º–µ–Ω–æ–≤—É—î —Ç–µ–º—É —ñ –æ–Ω–æ–≤–ª—é—î label  
‚úÖ /assign ‚Äî –ø—Ä–∞—Ü—é—î –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è  
‚úÖ /label ‚Äî –æ–Ω–æ–≤–ª—é—î –Ω–∞–∑–≤—É —Ç–µ–º–∏ –≤—Ä—É—á–Ω—É  
‚úÖ /close ‚Äî –∑–∞–∫—Ä–∏–≤–∞—î –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è, –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—É

---

# PetWealth Parents ‚Äî –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è —Å–∞–ø–ø–æ—Ä—Ç—É

–ú–µ—Ç–∞: –∫–æ—Ä–æ—Ç–∫–æ, —á—ñ—Ç–∫–æ ‚Äî —è–∫ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –±–æ—Ç–æ–º —É —Å–∞–ø–ø–æ—Ä—Ç-–≥—Ä—É–ø—ñ.

---

## 1) –î–µ –º–∏ –ø—Ä–∞—Ü—é—î–º–æ
- –£ —Å–∞–ø–ø–æ—Ä—Ç-–≥—Ä—É–ø—ñ PetWealth.
- –ö–æ–∂–µ–Ω –∫–ª—ñ—î–Ω—Ç –º–∞—î **—Å–≤–æ—é —Ç–µ–º—É (thread)**.
- –ü–∏—à–µ–º–æ —ñ –≤–∏–∫–æ–Ω—É—î–º–æ –∫–æ–º–∞–Ω–¥–∏ **–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ç–µ–º–∏**.

---

## 2) –û—Å–Ω–æ–≤–Ω—ñ –¥—ñ—ó
- –Ø–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –∫–ª—ñ—î–Ω—Ç—É –≤ —Ç–µ–º—ñ ‚Üí –±–æ—Ç –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—É.
- –Ø–∫—â–æ –∫–ª—ñ—î–Ω—Ç –ø–∏—à–µ ‚Äî –π–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ—Ç—Ä–∞–ø–ª—è—î —É —Ç–µ–º—É.

---

## 3) –ö–æ–º–∞–Ω–¥–∏

### /phone (–∞–±–æ /client)
–ü–æ–∫–∞–∑—É—î –∫–∞—Ä—Ç–∫—É –∫–ª—ñ—î–Ω—Ç–∞:
- –Ü–º‚Äô—è/–ø–æ–º—ñ—Ç–∫—É  
- Telegram ID  
- –ù—ñ–∫–Ω–µ–π–º  
- –¢–µ–ª–µ—Ñ–æ–Ω–∏:
  - –Ø–∫—â–æ –æ–¥–Ω–∞–∫–æ–≤—ñ ‚Üí –æ–¥–∏–Ω —Ä—è–¥–æ–∫ ‚Äú–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ ‚úÖ‚Äù.
  - –Ø–∫—â–æ —Ä—ñ–∑–Ω—ñ ‚Üí ‚Äú–±–æ—Ç‚Äù —ñ ‚Äú–Ñ–Ω–æ—Ç [enote]‚Äù.
  - –Ø–∫—â–æ –ª–∏—à–µ Enote ‚Üí ‚Äú[enote]‚Äù.

–ü—Ä–∏–∫–ª–∞–¥:
–ö–∞—Ä—Ç–∫–∞ –∫–ª—ñ—î–Ω—Ç–∞  
‚Ä¢ –ö–ª—ñ—î–Ω—Ç: –û–ª–µ–∫—Å—ñ–π ‚Äî –ë–µ—Ç–º–µ–Ω (1)  
‚Ä¢ –í–ª–∞—Å–Ω–∏–∫ (–Ñ–Ω–æ—Ç): –õ—å–æ–¥—ñ–Ω –û–ª–µ–∫—Å—ñ–π –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á  
‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: +380674210303 (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ ‚úÖ)

---

### /enote_link
–ü—Ä–∏–≤‚Äô—è–∑—É—î –∫–ª—ñ—î–Ω—Ç–∞ –¥–æ –≤–ª–∞—Å–Ω–∏–∫–∞ –≤ –Ñ–Ω–æ—Ç—ñ.

1. –£ —Ç–µ–º—ñ –∑—Ä–æ–±—ñ—Ç—å **reply** –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞ ‚Üí –Ω–∞–¥—ñ—à–ª—ñ—Ç—å `/enote_link`.  
2. –ë–æ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç—å **–Ω–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä—É**.  
3. –ü—ñ—Å–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è ‚Äî –ø–æ–∫–∞–∂–µ **–ø—Ä–µ–≤‚Äô—é (–ü–Ü–ë, —Ç–µ–ª–µ—Ñ–æ–Ω, —Ç–≤–∞—Ä–∏–Ω–∏)**.  
4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ‚úÖ –ü—Ä–∏–≤‚Äô—è–∑–∞—Ç–∏ –∞–±–æ ‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏.  
5. –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–≤‚Äô—è–∑–∫—É –±–æ—Ç –ø–æ–∫–∞–∂–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤ —Ç–µ–º—É.

---

### /patient
–ü–æ–∫–∞–∑—É—î —Å–ø–∏—Å–æ–∫ —É—Å—ñ—Ö —Ç–≤–∞—Ä–∏–Ω –≤–ª–∞—Å–Ω–∏–∫–∞:
–¢–≤–∞—Ä–∏–Ω–∏ –≤–ª–∞—Å–Ω–∏–∫–∞:  
‚Ä¢ –ë–µ—Ç–º–µ–Ω ‚Äî 1  
‚Ä¢ –°—ñ–ª—å–≤–∞ ‚Äî 2

---

### /auto_label
–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ñ–æ—Ä–º—É—î –Ω–∞–∑–≤—É —Ç–µ–º–∏:  
> –Ü–º‚Äô—è–í–ª–∞—Å–Ω–∏–∫–∞ ‚Äî –¢–≤–∞—Ä–∏–Ω–∞1(–¥–æ–≥–æ–≤—ñ—Ä), –¢–≤–∞—Ä–∏–Ω–∞2(–¥–æ–≥–æ–≤—ñ—Ä)  
—ñ –æ–Ω–æ–≤–ª—é—î –º—ñ—Ç–∫—É —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö.

---

### –Ü–Ω—à—ñ –∫–æ–º–∞–Ω–¥–∏
- /assign ‚Äî –ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–≤—Ü—è.  
- /label ‚Äî –≤—Ä—É—á–Ω—É –∑–∞–¥–∞—Ç–∏ –Ω–∞–∑–≤—É —Ç–µ–º–∏.  
- /close ‚Äî –∑–∞–∫—Ä–∏—Ç–∏ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è.  
- /reopen ‚Äî –ø–µ—Ä–µ–≤—ñ–¥–∫—Ä–∏—Ç–∏.  
- /close_silent ‚Äî –∑–∞–∫—Ä–∏—Ç–∏ –±–µ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—É.

---

## 4) –Ø–∫—â–æ —â–æ—Å—å –Ω–µ –ø—Ä–∞—Ü—é—î
- /enote_link ‚Äî –ø–æ–º–∏–ª–∫–∞ ‚Üí –ø–æ–≤—ñ–¥–æ–º –∞–¥–º—ñ–Ω–∞ (–º–æ–∂–µ –±—É—Ç–∏ —Ç–∞–π–º–∞—É—Ç –Ñ–Ω–æ—Ç–∞).  
- /phone ‚Äî –Ω–æ–º–µ—Ä—ñ–≤ –Ω–µ–º–∞—î ‚Üí –∫–ª—ñ—î–Ω—Ç –Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏–≤ —Ç–µ–ª–µ—Ñ–æ–Ω —É –±–æ—Ç—ñ.  
- /auto_label ‚Äî —Ç–µ–º–∞ –Ω–µ –ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞–ª–∞—Å—å ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä –¥–æ—Å—Ç—É–ø–∏ –±–æ—Ç–∞ –¥–æ —Ç–æ–ø—ñ–∫–∞.  
- /patient ‚Äî –ø–æ—Ä–æ–∂–Ω—ñ–π —Å–ø–∏—Å–æ–∫ ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä —á–∏ –≤–∏–∫–æ–Ω—É–≤–∞–ª–æ—Å—å /enote_link.

---

–î—è–∫—É—î–º–æ üíô  
–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –Ω–æ–≤–∞ –∫–æ–º–∞–Ω–¥–∞ ‚Äî —Å—Ç–≤–æ—Ä—ñ—Ç—å –∫–æ—Ä–æ—Ç–∫–µ –¢–ó, –∞–¥–º—ñ–Ω –¥–æ–¥–∞—Å—Ç—å —ó—ó —É –±–æ—Ç.
